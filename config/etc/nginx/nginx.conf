worker_processes 6;

events {
  worker_connections 10000;
}

http {
  sendfile on;

  upstream app {
    server 127.0.0.1:5000;
  }

  server {
    proxy_set_header X-Forwarded-Host $host;

    location ~ ^/(css|img|js)/ {
      open_file_cache max=100;
      root /home/isucon/webapp/public;

      proxy_cache cache-space;
      proxy_cache_valid 200 302 404 60m;
      proxy_cache_use_stale error timeout invalid_header;
    }

    location / {
      proxy_pass http://app;
    }
  }
}
